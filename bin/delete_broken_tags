#!/usr/bin/env ruby
#encoding: utf-8

$LOAD_PATH.unshift File.dirname(__FILE__) + '/../lib'

require 'init'
require 'colored'
require 'dbt'

DBT.auth

puts
DBT::Tag.confirm_broken
puts

if DBT::Tag.confirmed_broken.empty?
  puts "No broken tags were found or confirmed."
  puts
  exit
else
  puts "Broken tags:"
  DBT::Tag.confirmed_broken.each do |tag|
    puts " * " + tag.bold.red
  end
  puts
  DBT.confirm "Is this list correct? "
  puts
end
  

DBT::Photo.find.each do |photo|
  puts "Photo ID: #{photo.id}"
  photo.tags.each do |tag|
    if tag.broken?
      puts " * " + tag.content.bold.red
      photo.delete_tag(tag)
    else
      puts " * " + tag.content.green
    end
  end
  puts
end


